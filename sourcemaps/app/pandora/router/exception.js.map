{"version":3,"sources":["app/pandora/router/exception.ts"],"names":[],"mappings":"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","file":"../../../../app/pandora/router/exception.js","sourcesContent":["import { Dto } from '../aopImpl/dto';\nimport { Controller } from 'egg';\n\nexport type PDto<D extends Dto> = (new (...args: any[]) => D) & typeof Dto;\n\nexport class ExceptionThrown {\n    public static _dto: PDto<any>;\n    public static _config: ExceptionThrownConfig;\n\n    public static mount<D extends Dto>(dto: PDto<D>, config: ExceptionThrownConfig) {\n        this._dto = dto;\n        this._config = config;\n        return this;\n    }\n\n    public static exceper(action: Function) {\n        return async function (this: Controller, ...props: any[]) {\n            console.log(123123);\n            const Dto = ExceptionThrown._dto;\n            const resp = new Dto();\n            try {\n                const data = await action.apply(this, props);\n                console.log(111, data);\n                resp[ExceptionThrown._config.success] = data;\n                this.ctx.body = resp;\n            } catch (err) {\n                console.log(333, err);\n                resp[ExceptionThrown._config.error] = err;\n                resp[ExceptionThrown._config.errmsg] = err.message;\n            }\n        }\n    }\n}\n\nexport interface ExceptionThrownConfig {\n    success: string;\n    errmsg: string;\n    error: string;\n}\n\nexport function mount<D extends Dto>(dto: PDto<D>, config: ExceptionThrownConfig) {\n    return ExceptionThrown.mount(dto, config);\n}\n\nexport function Exception(code?: number): (target: any, prototypeKey: string, descr: TypedPropertyDescriptor<any>) => void;\nexport function Exception(target: any, prototypeKey: string, descr: TypedPropertyDescriptor<any>): void;\nexport function Exception(p: any, k?: string, d?: TypedPropertyDescriptor<any>) {\n    if (k && d) {\n        const action = p[k].bind(p);\n        d.value = async (...props: any[]) => {\n            console.log(123123);\n            const Dto = ExceptionThrown._dto;\n            const resp = new Dto();\n            try {\n                const data = await action.apply(p, props);\n                console.log(111, data);\n                resp[ExceptionThrown._config.success] = data;\n                p.ctx.body = resp;\n            } catch (err) {\n                console.log(333, err);\n                resp[ExceptionThrown._config.error] = err;\n                resp[ExceptionThrown._config.errmsg] = err.message;\n            }\n        };\n    } else {\n        return (target: any, prototypeKey: string, descr: PropertyDescriptor) => {\n            const action = target[prototypeKey].bind(target);\n            descr.value = async (...props: any[]) => {\n                console.log(123123);\n                const Dto = ExceptionThrown._dto;\n                const resp = new Dto();\n                try {\n                    const data = await action.apply(target, props);\n                    console.log(111, data);\n                    resp[ExceptionThrown._config.success] = data;\n                    target.ctx.body = resp;\n                } catch (err) {\n                    console.log(333, err);\n                    resp[ExceptionThrown._config.error] = err;\n                    resp[ExceptionThrown._config.errmsg] = err.message;\n                }\n            };\n        }\n    }\n}"]}